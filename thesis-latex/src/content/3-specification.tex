\chapter{Specification}

Before the team's first meeting in August, I looked up all the homework portals I've used during my student years to write up a preliminary specification~\cite{Szepes-specification} about what I expect from a homework portal as a student. Since September we had weekly meetings where we discussed the following topics: 

\begin{itemize}
	\item the old portal's features we want to keep without modifications
	\item the old portal's features we want to keep with modifications
	\item the old portal's features we want to eliminate, and
	\item new features we want to add
\end{itemize}

After a couple of meetings we had a list of features as the starting point for our specification. Then I used the 5 Whys technique to find the common roots of the features. 

\bence{Itt ki kéne fejteni azt, hogy honnan indulsz el és pontosan mi a célod a specifikációval.}

\section{Test Suite}
\bence{Talán más címet adnék itt meg, mert egy specifikációs módszertannal folytatod, nem a teszteléssel.}
In this section I introduce what kind of techniques I used to create the final specification. Some of these techniques serve as the basics of testing. I explain the testing in \refstruc{7-test}. 

\subsection{The 5 Whys}
\label{5-whys}

\bence{Kéne hivatkozás arra, hogy erről hol lehet bővebben olvasni, ui. ez egy létező, mások által is használt technika}

The 5 Whys is a technique to find the root cause of a problem simply by asking the question "Why?" multiple times. With this technique I can find out what does the user would like to achieve with using a feature. Why would the user like to use this feature? Does the user really want to use this or should the portal to this by default instead of the user? The 5 Whys also helps to decide when should I implement only one general feature instead of many specific features. For example, if the user wants to have 15 specific analytic features, I could consider making a general one instead of specific ones. 

\emph{Example:}

The student wants to list his commits from every branch in the laboratory's repository.
\begin{itemize}
	\item \emph{Why?} -- Because the student wants to tag one commit as final version.
	\item \emph{Why?} -- Because the evaluator will know which commit contains his homework.
	\item \emph{Why?} -- Because the evaluator has to correct the student's homework.
	\item \emph{Why?} -- Because the evaluator has to give the student a grade.
	\item \emph{Why?} -- Because the student has to pass the laboratory in order to pass the course.
\end{itemize}

In consequence of the 5 Whys, I also filtered out some features. Then I started to write the user stories to establish the basics for test automation.

\subsection{User Story}
A user story is a description of how can the user interact with the system, and what does the user have to do to use a certain feature. User stories are written in everyday language, and I can use them to run automated tests with a software tool. 

\subsubsection{Given When Then}

\bence{Kéne hivatkozás arra, hogy erről hol lehet bővebben olvasni}

\bence{Itt nincs meg a mondat összes része: The Given When Then convention for user stories.}

The \emph{Given} describes a state of the system. The \emph{When} describes an event. The \emph{Then} describes the result. If there are multiple Givens, I can use ~\emph{And} or \emph{But}. If you have the same Given statement for many stories, you can combine them as a \emph{background} section. A \emph{scenario} is an example of an executable action~\cite{Cucumber-scenario}. 

\bence{Úgy egyáltalán miért ezeket a szavakat használjuk, honnan jön ez az egész...}

\emph{Example:}

Background:\\ \hspace*{1cm}
Given a logged in student named "Jakab"\\ \hspace*{1cm}
And the settings page is loaded

Scenario: Setting a new SSH public key\\ \hspace*{1cm}
Given I am logged in as "Jakab"\\ \hspace*{1cm}
And I have entered a new SSH public key\\ \hspace*{1cm}
When I press the save button\\ \hspace*{1cm}
Then I should see "Your settings have been saved."

At first I wrote simple user stories without backgrounds and scenarios. I wrote them for all modules, and I focused only on the student module, because that's the first module I will implement. I finished writing scenarios for only that module \refstruc{user-stories}.

\subsubsection{Cucumber}

\bence{Hivatkozás}

\bence{Jó lenne tisztázni, hogy ezek pontosan milyen tesztek igazából.  Egyáltalán miért a specifikációs részben kerül szó tesztekről.}

User stories are good basics for testing. For testing I will use Cucumber. Cucumber is a software tool to run automated tests. It uses the Gherkin parser to parse feature files. A feature file contains user stories written in everyday language in a specific structure. In this project I will use English user stories~\cite{Cucumber-gherkin}. The usage is described in \refstruc{cucumber-test}.


\subsection{Mock Server}

\bence{Ide is illene hivatkozást írni}

\bence{A "contract" szó az, ami legjobban leírja a backend és a frontend kapcsolatát.  Ezt a szerződést kell mindkét félnek betartania.}

Because I only develop the front end, I wanted to make sure that I can work on the implementation without waiting for back end modules to be finished. To do that, I have to write an API specification and use a mock server. 

A \emph{mock server} simulates the behavior of the back end and offers mock data to work with. With a good API specification it will offer the same data as the future back end, and gives the opportunity to test the developed front end modules before the back end is finished.

I was looking for an API specification tool to design the communication between the back end and the front end and a mock server tool, that implements that API specification.

\subsubsection{API Blueprint}
\label{api-blueprint}

I want to use my API specification as a normal documentation for humans and as a mock server specification. \emph{API Blueprint}~\cite{api-blueprint} is an open source project, that gives me the option to write my specification in Markdown. Markdown~\cite{markdown} is a markup language to write plain text format and it can be converted into HTML. Markdown is often used to style messages on forums and readme files. 

\subsubsection{Drakov}

\bence{Itt megismételsz egy mondatot}

The API Blueprint~\cite{api-blueprint} team offers some tools, that implements API Blueprint specification. \emph{Drakov}~\cite{drakov} is one of these open source mock server tools, that implements API Blueprint specifications. The usage is described in \refstruc{mock-server-usage}.

\section{The Final Specification} \label{final-spec}
The final specification was made by me and finalized by the team.
\subsection{User Roles}

In the new portal there will be four different user roles: student, evaluator, demonstrator and administrator. 

\subsubsection{Student Role}

The student can:

\begin{itemize}
	\item see general information about his classes
	\begin{itemize}
		\item when will it be
		\item where will it be
		\item who will be the teacher
		\item when is the deadline for submitting the homework
		\item how much time is left until the deadline
		\item what is the Git remote URL
		\begin{itemize}
			\item The portal doesn't have an option to upload files, because students use Git repositories to upload their homeworks.
			\item With every laboratory they get a new Git repository in the Database Laboratory GitLab.
		\end{itemize}
	\end{itemize}
	\item check his results
	\begin{itemize}
		\item his entry test grade
		\item his laboratory report grade
		\item his laboratory report review
		\item who was the evaluator
		\item his laboratory grade
		\item his laboratory review
	\end{itemize}
	\item list his commits from every branch in the laboratory's repository
	\item tag a commit as a final version
	\begin{itemize}
		\item When the deadline is over, the back end will tag every branch's last commit.
		\item If the student didn't tag any commit as final version, the evaluator will check the solution only the master branch's commit, that was tagged by the back end.
	\end{itemize}
	\item see a summarized view of his grades
\end{itemize}

\subsubsection{Teacher}

The teacher can be a demonstrator and/or an evaluator \see{data-dictionary}. If a teacher is both a demonstrator and an evaluator, then the teacher can choose which role's pages the teacher wants to use.

\newparagraph{Demonstrator Role}

The demonstrator can:

\begin{itemize}
	\item see his current class with a list of students, who attended that class
	\begin{itemize}
		\item This list also contains the students' laboratory report grades and reviews.
	\end{itemize}
	\item give the students entry test grades
	\item give the students laboratory grades
	\item give the students laboratory reviews
	\item choose another class to list the students, who attended that class
	\begin{itemize}
		\item save the student's results as a draft
		\item continue writing a saved review draft
		\item publish the results for the student
	\end{itemize}
\end{itemize}

\newparagraph{Evaluator Role}

The evaluator can:

\begin{itemize}
	\item see a maximum of 4 lists of homeworks
	\begin{itemize}
		\item If a list doesn't have any element, it won't appear on the page.
		\item The first list contains the homeworks, that are waiting for evaluation and booked by the evaluator. 
		\item The second list contains the homeworks, that are waiting for evaluation and not booked yet. 
		\item The third list contains homeworks booked by another evaluator. 
		\item The fourth list contains the evaluated homeworks. 
	\end{itemize}
	\item book homeworks for himself for evaluation
	\item choose a homework to start the evaluation
	\item see the student's name and the Git remote URL as a general information for a homework
	\item give a laboratory report grade for a homework
	\item write a review for a homework
		\begin{itemize}
			\item save the review as a draft
			\item continue writing a saved review draft
			\item publish the grade and the review for the student
			\item If the student didn't tag any commit as final version, the evaluator will check the solution only in the last commit in the master branch.
		\end{itemize}
\end{itemize}

\subsubsection{Administrator Role}

The administrator role is a teacher role expanded with additional features.

The administrator can:

\begin{itemize}
	\item run SQL queries
	\item search for users
	\begin{itemize}
		\item with name
		\item with username
		\item with id
	\end{itemize}
	\item can change a user's e-mail
	\item can change a user's password
	\item can impersonate any user
	\item modify an evaluator's homework types
	\item add a new entry test question
	\item modify an entry test question
	\item delete an entry test question
	\item add a new event
	\item modify an existing event
	\item delete an existing event
	\item see the statistics
	\begin{itemize}
		\item list the unpublished reviews
		\item list the homeworks, that are waiting for evaluation
	\end{itemize}
\end{itemize}

\subsubsection{Default Options}

Any type of user can:

\begin{itemize}
	\item upload a new SSH public key
	\item set a new e-mail address
	\item set a new password
	\item change his mailing list subscription
	\item change his e-mail notifications subscription
\end{itemize}

\section{Meh, kene ide egy jo alcim}

\todo{hibaágak -> fogalmam sincs mire gondoltam, amikor ezt leírtam}

\bence{- 2.3: ha a "hibaágak" tekintetében a specifikáció "zöltutas"
	megközelítését szeretnéd kiegészíteni hibaágakkal, akkor korábban ezt a
	megközelítést is definiálnod kéne,}

\todo{mi az én feladatom?}

\bence{a hallgatói modul esetében a lehetséges hibautak felderítése a fenti
  "zöld" utak mellett.  pl. mi történik, ha a hallgató email-cím beírása nélkül
  nyom a profil mentése gombra...}
